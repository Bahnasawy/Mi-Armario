{"ast":null,"code":"import _regeneratorRuntime from\"/home/bahnasawy/Desktop/Mi-Armario/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/bahnasawy/Desktop/Mi-Armario/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/home/bahnasawy/Desktop/Mi-Armario/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/bahnasawy/Desktop/Mi-Armario/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/home/bahnasawy/Desktop/Mi-Armario/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/home/bahnasawy/Desktop/Mi-Armario/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/bahnasawy/Desktop/Mi-Armario/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import Cookies from'js-cookie';import axios from'axios';import sha256 from'js-sha256';import crypto from'crypto';var Login=/*#__PURE__*/function(_React$Component){_inherits(Login,_React$Component);var _super=_createSuper(Login);function Login(props){var _this;_classCallCheck(this,Login);_this=_super.call(this,props);_this.state={user_id:\"\",username:\"\",error:true,products:[]};_this.username=React.createRef();_this.password=React.createRef();_this.login=_this.login.bind(_assertThisInitialized(_this));_this.getProucts=_this.getProucts.bind(_assertThisInitialized(_this));_this.getCart=_this.getCart.bind(_assertThisInitialized(_this));_this.logout=_this.logout.bind(_assertThisInitialized(_this));_this.makeOrder=_this.makeOrder.bind(_assertThisInitialized(_this));_this.clearCart=_this.props.clearCart;return _this;}_createClass(Login,[{key:\"login\",value:function(){var _login=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var password,username,query,options,response,cookie;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(this.username.current.value&&this.password.current.value)){_context.next=11;break;}password=sha256(this.password.current.value);username=this.username.current.value;query=\"{customer(input:{username: \\\"\".concat(username,\"\\\", password: \\\"\").concat(password,\"\\\", id:\\\"\\\"}){id username}}\");options={url:\"http://localhost:5000/graphql\",method:\"POST\",headers:{'Accept':'application/json','Content-Type':'application/json'},data:{\"query\":query}};_context.next=7;return axios(options);case 7:response=_context.sent;if(response.data.data.customer.length!==0){cookie=JSON.parse(Cookies.get('mi-armario'));cookie.user_id=response.data.data.customer[0].id;cookie.username=response.data.data.customer[0].username;Cookies.set('mi-armario',cookie);this.setState({user_id:response.data.data.customer[0].id,username:response.data.data.customer[0].username});}else{this.setState({error:false});}_context.next=12;break;case 11:this.setState({error:false});case 12:case\"end\":return _context.stop();}}},_callee,this);}));function login(){return _login.apply(this,arguments);}return login;}()},{key:\"getProucts\",value:function(){var _getProucts=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var query,options,response;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:query=\"{product{id name}}\";options={url:\"http://localhost:5000/graphql\",method:\"POST\",headers:{'Accept':'application/json','Content-Type':'application/json'},data:{\"query\":query}};_context2.next=4;return axios(options);case 4:response=_context2.sent;this.setState({products:response.data.data.product});case 6:case\"end\":return _context2.stop();}}},_callee2,this);}));function getProucts(){return _getProucts.apply(this,arguments);}return getProucts;}()},{key:\"logout\",value:function logout(){var cookie=JSON.parse(Cookies.get('mi-armario'));cookie.cart={};cookie.username=\"\";cookie.user_id=\"\";Cookies.set('mi-armario',cookie);this.clearCart();this.setState({user_id:\"\",username:\"\",cart:{}});}},{key:\"getCart\",value:function getCart(){var _this2=this;var items=[];if(Object.keys(this.props.cart).length>0){try{Object.keys(this.props.cart).map(function(key){return _this2.state.products.forEach(function(product){if(key===product.id){items.push(/*#__PURE__*/React.createElement(\"div\",{className:\"dropdown-item\",key:key,onClick:_this2.getProucts},product.name,\": \",_this2.props.cart[key]));}});});return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"label\",{className:\"font-weight-bold\"},\"Your Cart\"),items,/*#__PURE__*/React.createElement(\"button\",{className:\"btn btn-outline-dark\",onClick:this.makeOrder},\"Order\"));}catch(error){return null;}}else{return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"label\",{className:\"font-weight-bold\"},\"Your Cart is Empty\"));}}},{key:\"makeOrder\",value:function(){var _makeOrder=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var _this3=this;var id,query,variables,sale,sale_item,set,where,sale_item_id,product_sets,product_wheres,sale_items,product_set_vars,product_where_vars,sale_item_vars,updates,inserts,cookie,_loop,i,_i,_i2,options,response;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:id=crypto.randomBytes(5).toString('hex');sale_item=[];set=[];where=[];sale_item_id=[];product_sets=[];product_wheres=[];sale_items=[];product_set_vars=[];product_where_vars=[];sale_item_vars=[];updates=[];inserts=[];cookie=JSON.parse(Cookies.get('mi-armario'));_loop=function _loop(i){Object.keys(_this3.props.cart).forEach(function(key){if(_this3.props.products[i].id===key){set.push(\"\\\"quantity\\\": \".concat(_this3.props.products[i].quantity));where.push(\"\\\"id\\\": \\\"\".concat(key,\"\\\"\"));sale_item_id.push(\"\\\"product_id\\\": \\\"\".concat(key,\"\\\"\"));sale_item.push(\"\\\"quantity\\\": \".concat(_this3.props.cart[key]));}});};for(i=0;i<this.props.products.length;i++){_loop(i);}sale=\"\\n            \\\"sale\\\":{\\n                \\\"sale\\\": {\\n                    \\\"id\\\": \\\"\".concat(id,\"\\\",\\n                    \\\"status\\\": \\\"pending\\\",\\n                    \\\"customer_id\\\": \\\"\").concat(cookie.user_id,\"\\\"\\n                  }\\n            }\");for(_i=0;_i<set.length;_i++){product_sets.push(\"\\\"product_set\".concat(_i,\"\\\": {\\n                \\\"product\\\": {\\n                    \").concat(set[_i],\"\\n                }\\n            }\"));product_wheres.push(\"\\\"product_where\".concat(_i,\"\\\": {\\n                \\\"product\\\": {\\n                    \").concat(where[_i],\"\\n                }\\n            }\"));sale_items.push(\"\\\"sale_item\".concat(_i,\"\\\": {\\n                \\\"sale_item\\\": {\\n                    \").concat(sale_item[_i],\",\\n                    \").concat(sale_item_id[_i],\",\\n                    \\\"sale_id\\\":\\\"\").concat(id,\"\\\"\\n                }\\n            }\"));product_set_vars.push(\"$product_set\".concat(_i,\": Tables!\"));product_where_vars.push(\"$product_where\".concat(_i,\": Tables!\"));sale_item_vars.push(\"$sale_item\".concat(_i,\": Tables!\"));}variables=\"{\\n            \".concat(product_sets.join(\",\\n\"),\",\\n            \").concat(product_wheres.join(\",\\n\"),\",\\n            \").concat(sale,\",\\n            \").concat(sale_items.join(\",\\n\"),\"\\n        }\");for(_i2=0;_i2<product_sets.length;_i2++){updates.push(\"product\".concat(_i2,\": update(set:$product_set\").concat(_i2,\" where:$product_where\").concat(_i2,\")\"));inserts.push(\"sale_item\".concat(_i2,\": insert(input:$sale_item\").concat(_i2,\")\"));}query=\"mutation(\\n            \".concat(product_set_vars.join(\",\\n\"),\",\\n            \").concat(product_where_vars.join(\",\\n\"),\",\\n            \").concat(sale_item_vars.join(\",\\n\"),\"\\n            $sale: Tables!){\\n            sale: insert(input:$sale)\\n            \").concat(updates.join(\",\\n\"),\"\\n            \").concat(inserts.join(\",\\n\"),\"\\n          }\");options={url:\"http://localhost:5000/graphql\",method:\"POST\",headers:{'content-type':'application/json'},data:{\"query\":query,\"variables\":variables}};// console.log(options)\n_context3.next=24;return axios(options);case 24:response=_context3.sent;console.log(response);cookie.cart={};Cookies.set('mi-armario',cookie);this.clearCart();this.setState({cart:{}});case 30:case\"end\":return _context3.stop();}}},_callee3,this);}));function makeOrder(){return _makeOrder.apply(this,arguments);}return makeOrder;}()},{key:\"componentDidMount\",value:function componentDidMount(){try{var cookie=JSON.parse(Cookies.get('mi-armario'));if(cookie.username!==\"\"){this.setState({username:cookie.username});}}catch(e){}this.getProucts();}},{key:\"render\",value:function render(){if(this.state.username===\"\"){return/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex btn-group dropdown container-fluid\"},/*#__PURE__*/React.createElement(\"button\",{className:\"btn btn-light border border-light rounded-1 mr-2 dropdown-toggle\",type:\"button\",style:{fontFamily:'DM Mono, monospace',fontSize:'small',fontWeight:500},\"data-toggle\":\"dropdown\"},\"Login\"),/*#__PURE__*/React.createElement(\"div\",{className:\"dropdown-menu dropdown-menu-right p-2\",\"aria-labelledby\":\"dropdownMenuButton\",style:{width:\"300px\"}},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group\"},/*#__PURE__*/React.createElement(\"label\",{className:\"font-weight-bold\"},\"Username\"),/*#__PURE__*/React.createElement(\"input\",{className:\"form-control\",type:\"text\",ref:this.username,autoComplete:\"off\"}),/*#__PURE__*/React.createElement(\"small\",{className:\"form-text text-muted\"},\"We'll never share your email with anyone else.\")),/*#__PURE__*/React.createElement(\"div\",{className:\"form-group\"},/*#__PURE__*/React.createElement(\"label\",{className:\"font-weight-bold\"},\"Password\"),/*#__PURE__*/React.createElement(\"input\",{className:\"form-control\",type:\"password\",ref:this.password})),/*#__PURE__*/React.createElement(\"button\",{className:\"btn btn-outline-dark float-right\",onClick:this.login},\"Login\"),/*#__PURE__*/React.createElement(\"small\",{className:\"text-danger\",hidden:this.state.error},\"*Wrong Username or Password\")));}else{return/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex btn-group dropdown container-fluid\"},/*#__PURE__*/React.createElement(\"button\",{className:\"btn btn-light border border-light rounded-1 mr-2 dropdown-toggle\",type:\"button\",style:{fontFamily:'DM Mono, monospace',fontSize:'small',fontWeight:500},\"data-toggle\":\"dropdown\"},this.state.username),/*#__PURE__*/React.createElement(\"div\",{className:\"dropdown-menu dropdown-menu-right p-2\",\"aria-labelledby\":\"dropdownMenuButton\",style:{width:\"300px\"}},/*#__PURE__*/React.createElement(\"div\",null,this.getCart()),/*#__PURE__*/React.createElement(\"div\",{role:\"separator\",className:\"dropdown-divider\"}),/*#__PURE__*/React.createElement(\"button\",{className:\"btn btn-outline-dark float-right\",onClick:this.logout},\"Logout\")));}}}]);return Login;}(React.Component);export{Login as default};","map":{"version":3,"sources":["/home/bahnasawy/Desktop/Mi-Armario/client/src/components/Login.js"],"names":["React","Cookies","axios","sha256","crypto","Login","props","state","user_id","username","error","products","createRef","password","login","bind","getProucts","getCart","logout","makeOrder","clearCart","current","value","query","options","url","method","headers","data","response","customer","length","cookie","JSON","parse","get","id","set","setState","product","cart","items","Object","keys","map","key","forEach","push","name","randomBytes","toString","sale_item","where","sale_item_id","product_sets","product_wheres","sale_items","product_set_vars","product_where_vars","sale_item_vars","updates","inserts","i","quantity","sale","variables","join","console","log","e","fontFamily","fontSize","fontWeight","width","Component"],"mappings":"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","sourcesContent":["import React from 'react'\nimport Cookies from 'js-cookie'\nimport axios from 'axios'\nimport sha256 from 'js-sha256'\nimport crypto from 'crypto'\n\nexport default class Login extends React.Component \n{\n    constructor(props) {\n        super(props)\n        this.state = {user_id: \"\", username: \"\", error:true, products: []}\n        this.username = React.createRef()\n        this.password = React.createRef()\n\n        this.login = this.login.bind(this)\n        this.getProucts = this.getProucts.bind(this)\n        this.getCart = this.getCart.bind(this)\n        this.logout = this.logout.bind(this)\n        this.makeOrder = this.makeOrder.bind(this)\n        this.clearCart = this.props.clearCart\n    }\n\n    async login() {\n        if (this.username.current.value && this.password.current.value)\n        {\n            const password = sha256(this.password.current.value)\n            const username = this.username.current.value\n            const query = `{customer(input:{username: \"${username}\", password: \"${password}\", id:\"\"}){id username}}`\n            const options = {\n                url: \"http://localhost:5000/graphql\",\n                method: \"POST\",\n                headers: {'Accept': 'application/json',\n                'Content-Type': 'application/json'},\n                data: {\n                    \"query\": query\n                }\n            }\n            const response = await axios(options)\n            if (response.data.data.customer.length !== 0)\n            {\n                const cookie = JSON.parse(Cookies.get('mi-armario'))\n                cookie.user_id = response.data.data.customer[0].id\n                cookie.username = response.data.data.customer[0].username\n                Cookies.set('mi-armario', cookie)\n                this.setState({\n                    user_id: response.data.data.customer[0].id, \n                    username: response.data.data.customer[0].username})\n            }\n            else{\n                this.setState({ error: false })\n            }\n        }\n        else {\n            this.setState(\n                {error:false}\n            )\n        }\n    }\n\n    async getProucts(){\n        const query = `{product{id name}}`\n        const options = {\n            url: \"http://localhost:5000/graphql\",\n            method: \"POST\",\n            headers: {'Accept': 'application/json',\n            'Content-Type': 'application/json'},\n            data: {\n                \"query\": query\n            }\n        }\n        const response = await axios(options)\n        this.setState({products: response.data.data.product})\n    }\n\n    logout()\n    {\n        const cookie = JSON.parse(Cookies.get('mi-armario'))\n        cookie.cart = {}\n        cookie.username = \"\"\n        cookie.user_id = \"\"\n        Cookies.set('mi-armario', cookie)\n        this.clearCart()\n        this.setState({\n            user_id: \"\",\n            username: \"\",\n            cart: {}\n        })\n    }\n\n    getCart()\n    {\n        const items = []\n        if (Object.keys(this.props.cart).length > 0)\n        {\n            try{\n                Object.keys(this.props.cart).map(key => {\n                    return this.state.products.forEach(product => {\n                        if (key === product.id)\n                        {\n                            items.push(\n                                <div className=\"dropdown-item\" key={key} onClick={this.getProucts}>\n                                    {product.name}: {this.props.cart[key]}\n                                </div>\n                            )\n                        }\n                    })\n                })\n                return (<div>\n                            <label className=\"font-weight-bold\">Your Cart</label>\n                            {items}\n                            <button className=\"btn btn-outline-dark\" onClick={this.makeOrder}>Order</button>\n                        </div>)\n            }\n            catch (error) {return null}\n        }\n        else\n        {\n            return (<div>\n                <label className=\"font-weight-bold\">Your Cart is Empty</label>\n            </div>)\n        }\n    }\n\n    async makeOrder()\n    {\n        let id = crypto.randomBytes(5).toString('hex')\n        let query;\n        let variables;\n        let sale;\n        let sale_item = [];\n        let set = [];\n        let where = [];\n        let sale_item_id = []\n        let product_sets = []\n        let product_wheres = []\n        let sale_items = []\n        let product_set_vars = []\n        let product_where_vars = []\n        let sale_item_vars = []\n        let updates = []\n        let inserts = []\n\n        let cookie = JSON.parse(Cookies.get('mi-armario'))\n\n        for(let i = 0; i < this.props.products.length;i++)\n        {\n            Object.keys(this.props.cart).forEach(key => {\n                if (this.props.products[i].id === key)\n                {\n                    set.push(`\"quantity\": ${this.props.products[i].quantity}`)\n                    where.push(`\"id\": \"${key}\"`)\n                    sale_item_id.push(`\"product_id\": \"${key}\"`)\n                    sale_item.push(`\"quantity\": ${this.props.cart[key]}`)\n                }\n                \n            })\n        }\n\n        sale = `\n            \"sale\":{\n                \"sale\": {\n                    \"id\": \"${id}\",\n                    \"status\": \"pending\",\n                    \"customer_id\": \"${cookie.user_id}\"\n                  }\n            }`\n            \n\n        for (let i = 0; i < set.length; i++)\n        {\n            product_sets.push(`\"product_set${i}\": {\n                \"product\": {\n                    ${set[i]}\n                }\n            }`)\n            product_wheres.push(`\"product_where${i}\": {\n                \"product\": {\n                    ${where[i]}\n                }\n            }`)\n\n            sale_items.push(`\"sale_item${i}\": {\n                \"sale_item\": {\n                    ${sale_item[i]},\n                    ${sale_item_id[i]},\n                    \"sale_id\":\"${id}\"\n                }\n            }`)\n\n            product_set_vars.push(`$product_set${i}: Tables!`)\n            product_where_vars.push(`$product_where${i}: Tables!`)\n            sale_item_vars.push(`$sale_item${i}: Tables!`)\n        }\n\n        variables = `{\n            ${product_sets.join(\",\\n\")},\n            ${product_wheres.join(\",\\n\")},\n            ${sale},\n            ${sale_items.join(\",\\n\")}\n        }`\n\n        for(let i = 0; i < product_sets.length; i++){\n            updates.push(`product${i}: update(set:$product_set${i} where:$product_where${i})`)\n            inserts.push(`sale_item${i}: insert(input:$sale_item${i})`)\n        }\n\n        query = `mutation(\n            ${product_set_vars.join(\",\\n\")},\n            ${product_where_vars.join(\",\\n\")},\n            ${sale_item_vars.join(\",\\n\")}\n            $sale: Tables!){\n            sale: insert(input:$sale)\n            ${updates.join(\",\\n\")}\n            ${inserts.join(\",\\n\")}\n          }`\n        \n        const options = {\n            url: \"http://localhost:5000/graphql\",\n            method: \"POST\",\n            headers: {'content-type': 'application/json'},\n            data: {\n                \"query\": query,\n                \"variables\": variables\n            }\n        }\n\n        // console.log(options)\n        const response = await axios(options)\n        console.log(response)\n\n        cookie.cart = {}\n        Cookies.set('mi-armario', cookie)\n        this.clearCart()\n        this.setState({\n            cart: {}\n        })\n    }\n\n    componentDidMount() {\n        try{\n            const cookie = JSON.parse(Cookies.get('mi-armario'))\n            if (cookie.username !== \"\")\n            {\n                this.setState({username: cookie.username})\n            }\n        }\n        catch (e) {}\n        this.getProucts()\n    }\n\n    render() {\n        if (this.state.username === \"\")\n        {\n            return (\n                <div className=\"d-flex btn-group dropdown container-fluid\">\n                    <button \n                    className=\"btn btn-light border border-light rounded-1 mr-2 dropdown-toggle\"\n                    type=\"button\"\n                    style={{fontFamily: 'DM Mono, monospace', fontSize: 'small', fontWeight: 500}}\n                    data-toggle=\"dropdown\">\n                        Login\n                    </button>\n                    <div className=\"dropdown-menu dropdown-menu-right p-2\" aria-labelledby=\"dropdownMenuButton\" style={{width:\"300px\"}}>\n                        <div className=\"form-group\">\n                            <label className=\"font-weight-bold\">Username</label>\n                            <input className=\"form-control\" type=\"text\" ref={this.username} autoComplete=\"off\"/><small className=\"form-text text-muted\">We'll never share your email with anyone else.</small>\n                        </div>\n                        <div className=\"form-group\">\n                            <label className=\"font-weight-bold\">Password</label>\n                            <input className=\"form-control\" type=\"password\" ref={this.password}/>\n                        </div>\n                        <button className=\"btn btn-outline-dark float-right\" onClick={this.login}>Login</button>\n                        <small className=\"text-danger\" hidden={this.state.error}>*Wrong Username or Password</small>\n                    </div>\n                </div>\n            )\n        }\n        else\n        {\n            return (\n                <div className=\"d-flex btn-group dropdown container-fluid\">\n                    <button \n                    className=\"btn btn-light border border-light rounded-1 mr-2 dropdown-toggle\"\n                    type=\"button\"\n                    style={{fontFamily: 'DM Mono, monospace', fontSize: 'small', fontWeight: 500}}\n                    data-toggle=\"dropdown\">\n                        {this.state.username}\n                    </button>\n                    <div className=\"dropdown-menu dropdown-menu-right p-2\" aria-labelledby=\"dropdownMenuButton\" style={{width:\"300px\"}}>\n                        <div>\n                            {this.getCart()}\n                        </div>\n                        <div role=\"separator\" className=\"dropdown-divider\"></div>\n                        <button className=\"btn btn-outline-dark float-right\" onClick={this.logout}>Logout</button>\n                    </div>\n                </div>\n            )\n        }\n    }\n} "]},"metadata":{},"sourceType":"module"}